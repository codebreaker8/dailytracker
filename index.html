<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
      <link rel="icon" href="icon.png" type="image/png">
  <link rel="icon" type="image/png" href="icon.png">
  <link rel="apple-touch-icon"  href="icon.png">
<title>Productivity Planner</title>
<style>
:root {
  --bg: #f8fafc; --bg2: #ffffff; --text: #1e293b; --text2: #64748b;
  --accent: #4f46e5; --done: #10b981; --wrong: #ef4444; --neutral: #fbbf24;
  --grid: #e2e8f0; --shadow: 0 4px 12px rgba(0,0,0,0.05); --radius: 10px;
  --protocol-border: #d1d5db; --screen-active: #8b5cf6;
}
.dark { --bg: #0f172a; --bg2: #1e293b; --text: #f1f5f9; --text2: #94a3b8;
  --accent: #8b5cf6; --grid: #334155; --shadow: 0 4px 12px rgba(0,0,0,0.2);
  --protocol-border: #475569; --screen-active: #a78bfa; }

* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: var(--bg); color: var(--text); transition: 0.3s; }
.wrap { max-width: 1400px; margin: 20px auto; padding: 20px; }

header { display: flex; justify-content: space-between; align-items: center;
  margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid var(--accent); }
h1 { font-size: 28px; font-weight: 800; background: linear-gradient(90deg, #4f46e5, #8b5cf6);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.month-display { font-size: 18px; font-weight: 600; color: var(--accent); }
.today { background: var(--accent); color: white; padding: 6px 14px;
  border-radius: 20px; font-size: 14px; font-weight: 600; }
.controls { display: flex; gap: 12px; align-items: center; }
.btn { padding: 8px 16px; border: none; border-radius: 6px;
  background: var(--bg2); color: var(--text); cursor: pointer;
  font-weight: 600; box-shadow: var(--shadow); transition: 0.2s;
  border: 1px solid var(--grid); }
.btn:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(0,0,0,0.1); }
.theme-toggle { width: 40px; height: 22px; background: var(--grid);
  border-radius: 11px; position: relative; cursor: pointer; border: 2px solid var(--accent); }
.theme-toggle::after { content: ''; position: absolute; top: 2px; left: 2px;
  width: 14px; height: 14px; background: var(--bg2); border-radius: 50%;
  transition: 0.3s; }
.dark .theme-toggle::after { transform: translateX(18px); }

.grid-container { background: var(--bg2); border-radius: var(--radius);
  padding: 24px; margin-bottom: 24px; box-shadow: var(--shadow);
  border: 1px solid var(--grid); }
.grid-title { font-size: 18px; font-weight: 700; margin-bottom: 20px;
  display: flex; align-items: center; gap: 10px; color: var(--text); }
.grid-title::before { content: ''; width: 6px; height: 20px;
  background: var(--accent); border-radius: 3px; }

.table-wrap { overflow-x: auto; border-radius: 8px; border: 1px solid var(--grid); }
table { border-collapse: collapse; width: 100%; min-width: 1000px; }
thead th { padding: 14px 6px; border-bottom: 2px solid var(--accent);
  font-size: 12px; text-align: center; color: var(--text2); background: var(--bg2); }
.day-header { display: flex; flex-direction: column; align-items: center; gap: 6px; }
.day-num { font-size: 14px; font-weight: 700; color: var(--text); }
.day-name { font-size: 10px; color: var(--text2); text-transform: uppercase; }
.today-marker { width: 6px; height: 6px; background: #ef4444;
  border-radius: 50%; margin-top: 2px; }
.protocol-name { width: 300px; padding: 12px 16px; text-align: left;
  font-weight: 600; font-size: 14px; background: var(--bg2);
  position: sticky; left: 0; border-right: 2px solid var(--accent); }
.protocol-name input { width: 100%; border: none; background: transparent;
  font-size: 14px; color: var(--text); padding: 8px 10px; border-radius: 4px;
  min-height: 40px; }
.protocol-name input:focus { outline: none; background: rgba(79, 70, 229, 0.05); }
td.cell { width: 42px; height: 42px; border: 1px solid var(--protocol-border);
  text-align: center; cursor: pointer; transition: all 0.2s; font-size: 16px;
  background: var(--bg2); }
td.cell:hover { background: rgba(79, 70, 229, 0.1); transform: scale(1.05); }
td.done { background: #10b981; color: white; border-color: #10b981; }
td.wrong { background: #ef4444; color: white; border-color: #ef4444; }
td.neutral { background: #fbbf24; color: white; border-color: #fbbf24; }

.screen-wrapper { display: flex; gap: 20px; margin-top: 20px; }
.hour-labels { display: flex; flex-direction: column; gap: 26px;
  width: 80px; padding-top: 40px; }
.hour-label { font-size: 13px; font-weight: 700; color: var(--text);
  text-align: right; height: 28px; display: flex; align-items: center;
  justify-content: flex-end; padding-right: 8px; }
.hour-label:nth-child(1) { color: #ef4444; }
.hour-label:nth-child(2) { color: #f97316; }
.hour-label:nth-child(3) { color: #f59e0b; }
.hour-label:nth-child(4) { color: #84cc16; }
.hour-label:nth-child(5) { color: #0ea5e9; }
.hour-label:nth-child(6) { color: #8b5cf6; }
.screen-grid { flex: 1; }
.dates-row { display: flex; gap: 2px; margin-bottom: 12px;
  padding-left: 4px; border-bottom: 2px solid var(--grid); padding-bottom: 8px; }
.date-cell { width: 32px; text-align: center; font-size: 12px;
  font-weight: 600; color: var(--text2); padding: 6px 0;
  position: relative; transition: 0.2s; }
.date-cell.today { color: var(--text); font-weight: 800; }
.date-cell.today::after { content: ''; position: absolute; bottom: -10px;
  left: 50%; transform: translateX(-50%); width: 8px; height: 8px;
  background: #ef4444; border-radius: 50%; box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.3); }
.dots-grid { display: flex; flex-direction: column; gap: 26px; }
.dots-row { display: flex; gap: 2px; align-items: center; }
.dot { width: 32px; height: 28px; border: 2px solid var(--grid);
  border-radius: 6px; cursor: pointer; transition: all 0.2s;
  background: var(--bg); }
.dot:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
.dot.active { background: var(--screen-active); border-color: var(--screen-active);
  box-shadow: 0 2px 8px rgba(139, 92, 246, 0.3); }
.dot.today { border-color: #ef4444; }
.graph-container { height: 140px; margin-top: 24px; border: 1px solid var(--grid);
  border-radius: var(--radius); padding: 16px; background: var(--bg);
  box-shadow: inset 0 2px 8px rgba(0,0,0,0.05); }

.ach-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 16px; margin-top: 20px; }
.ach-item { padding: 18px; border-radius: 10px; background: var(--bg);
  border: 2px solid var(--grid); cursor: pointer; transition: 0.2s;
  display: flex; align-items: center; gap: 16px; }
.ach-item:hover { transform: translateY(-3px); box-shadow: var(--shadow);
  border-color: var(--accent); }
.ach-dot { width: 22px; height: 22px; border-radius: 50%;
  border: 2px solid var(--grid); flex-shrink: 0; transition: 0.2s; }
.ach-dot.on { background: var(--done); border-color: var(--done);
  box-shadow: 0 0 12px rgba(16, 185, 129, 0.3); }
.history { display: flex; gap: 12px; overflow-x: auto; padding: 12px 0; }
.month-card { min-width: 160px; padding: 16px; border-radius: 10px;
  background: var(--bg2); border: 2px solid var(--grid); cursor: pointer;
  transition: 0.2s; }
.month-card.active { border-color: var(--accent); background: linear-gradient(135deg, rgba(79, 70, 229, 0.1), transparent); }
.month-card:hover { transform: translateY(-3px); box-shadow: var(--shadow); }

.stats { display: flex; gap: 20px; margin: 24px 0; }
.stat-box { flex: 1; background: linear-gradient(135deg, var(--bg2), var(--bg));
  padding: 20px; border-radius: var(--radius); box-shadow: var(--shadow);
  border: 1px solid var(--grid); text-align: center; }
.stat-value { font-size: 32px; font-weight: 800; background: linear-gradient(90deg, #4f46e5, #8b5cf6);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.stat-label { font-size: 14px; color: var(--text2); margin-top: 6px; font-weight: 600; }

@media (max-width: 768px) {
  header { flex-direction: column; align-items: flex-start; gap: 16px; }
  .screen-wrapper { flex-direction: column; }
  .hour-labels { width: 100%; flex-direction: row; justify-content: space-around;
    padding-top: 0; margin-bottom: 20px; }
  .hour-label { height: auto; padding-right: 0; }
  .stats { flex-direction: column; }
  .ach-grid { grid-template-columns: 1fr; }
}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>Productivity Planner</h1>
      <div class="month-display" id="monthName">January 2024</div>
    </div>
    <div class="today" id="todayDisplay">Today: Day 15</div>
    <div class="controls">
      <div class="theme-toggle" id="themeToggle" title="Toggle dark/light mode"></div>
      <button class="btn" id="resetBtn">Reset Month</button>
    </div>
  </header>

  <div class="stats">
    <div class="stat-box">
      <div class="stat-value" id="progressStat">0%</div>
      <div class="stat-label">Completion Rate</div>
    </div>
    <div class="stat-box">
      <div class="stat-value" id="levelStat">1</div>
      <div class="stat-label">Current Level</div>
    </div>
    <div class="stat-box">
      <div class="stat-value" id="screenStat">0h</div>
      <div class="stat-label">Today's Screen Time</div>
    </div>
  </div>

  <div class="grid-container">
    <div class="grid-title">Daily Protocols</div>
    <div class="table-wrap">
      <table id="protocolTable">
        <thead><tr><th>PROTOCOL</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="grid-container">
    <div class="grid-title">Screen Time Tracker</div>
    <div class="screen-wrapper">
      <div class="hour-labels">
        <div class="hour-label">7h+</div>
        <div class="hour-label">6h</div>
        <div class="hour-label">5h</div>
        <div class="hour-label">4h</div>
        <div class="hour-label">3h</div>
        <div class="hour-label">2h</div>
      </div>
      <div class="screen-grid">
        <div class="dates-row" id="datesRow"></div>
        <div class="dots-grid" id="dotsContainer"></div>
      </div>
    </div>
    <div class="graph-container"><canvas id="screenGraph"></canvas></div>
  </div>

  <div class="grid-container">
    <div class="grid-title">Achievements</div>
    <div class="ach-grid">
      <div class="ach-item" data-idx="0">
        <div class="ach-dot" id="ach0"></div>
        <div><strong>Consistency Master</strong><br><small>Complete all protocols for 7 consecutive days</small></div>
      </div>
      <div class="ach-item" data-idx="1">
        <div class="ach-dot" id="ach1"></div>
        <div><strong>Screen Time Control</strong><br><small>Keep screen time under 4h for 5 days in a row</small></div>
      </div>
      <div class="ach-item" data-idx="2">
        <div class="ach-dot" id="ach2"></div>
        <div><strong>Productivity Pro</strong><br><small>Reach level 5 and maintain 80%+ completion</small></div>
      </div>
    </div>
  </div>

  <div class="grid-container">
    <div class="grid-title">Monthly History</div>
    <div class="history" id="monthHistory"></div>
  </div>
</div>

<script>
const DAYS = 31, ROWS = 10;
const HOUR_LEVELS = ['2h','3h','4h','5h','6h','7h+'];
const STORAGE_KEY = "planner_final";
const MONTHS = ["January","February","March","April","May","June","July","August","September","October","November","December"];
const DAYS_NAME = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];

let state = {
  currentMonth: new Date().getFullYear() + "-" + (new Date().getMonth()+1).toString().padStart(2,'0'),
  months: {},
  theme: "light"
};

function init() {
  loadState();
  setupTheme();
  renderAll();
  setInterval(saveState, 3000);
}

function loadState() {
  const saved = localStorage.getItem(STORAGE_KEY);
  if (saved) Object.assign(state, JSON.parse(saved));
  if (!state.months[state.currentMonth]) createMonth(state.currentMonth);
}

function saveState() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

function createMonth(key) {
  const [y,m] = key.split("-").map(Number);
  state.months[key] = {
    name: MONTHS[m-1] + " " + y,
    level: 1,
    protocols: Array.from({length:ROWS},(_,i)=>`Protocol ${i+1}`),
    cells: {},
    screen: Array(DAYS).fill(-1),
    achievements: [false,false,false],
    createdAt: new Date().toISOString()
  };
}

function currentMonth() {
  return state.months[state.currentMonth];
}

function setupTheme() {
  document.getElementById('themeToggle').onclick = () => {
    state.theme = state.theme === "light" ? "dark" : "light";
    document.body.classList.toggle('dark', state.theme === "dark");
    saveState();
  };
  document.body.classList.toggle('dark', state.theme === "dark");
}

function renderProtocols() {
  const cm = currentMonth();
  const today = new Date();
  const isCurrentMonth = state.currentMonth === `${today.getFullYear()}-${today.getMonth()+1}`;
  
  let thead = '<tr><th class="protocol-name">PROTOCOL</th>';
  for(let d=1; d<=DAYS; d++) {
    const date = new Date(today.getFullYear(), today.getMonth(), d);
    const dayName = DAYS_NAME[date.getDay()];
    const isToday = isCurrentMonth && d === today.getDate();
    thead += `<th><div class="day-header">
      <div class="day-num">${d}</div>
      <div class="day-name">${dayName}</div>
      ${isToday ? '<div class="today-marker"></div>' : ''}
    </div></th>`;
  }
  thead += '</tr>';
  document.querySelector('#protocolTable thead').innerHTML = thead;
  
  let tbody = '';
  for(let r=0; r<ROWS; r++) {
    tbody += `<tr>
      <td class="protocol-name">
        <input value="${cm.protocols[r]}" oninput="updateProtocol(${r},this.value)">
      </td>`;
    for(let d=0; d<DAYS; d++) {
      const key = `${r}_${d}`;
      const status = cm.cells[key] || 0;
      const cls = status === 1 ? 'done' : status === 2 ? 'wrong' : status === 3 ? 'neutral' : '';
      const symbol = status === 1 ? '✅' : status === 2 ? '❌' : status === 3 ? '○' : '';
      tbody += `<td class="cell ${cls}" onclick="toggleProtocol(${r},${d})">${symbol}</td>`;
    }
    tbody += '</tr>';
  }
  document.querySelector('#protocolTable tbody').innerHTML = tbody;
}

function toggleProtocol(r,d) {
  const key = `${r}_${d}`;
  const cm = currentMonth();
  cm.cells[key] = ((cm.cells[key] || 0) + 1) % 4;
  renderProtocols();
  updateStats();
  saveState();
}

function updateProtocol(r,val) {
  currentMonth().protocols[r] = val;
  saveState();
}

function renderScreenTime() {
  const cm = currentMonth();
  const today = new Date();
  const isCurrentMonth = state.currentMonth === `${today.getFullYear()}-${today.getMonth()+1}`;
  
  let dates = '';
  for(let d=1; d<=DAYS; d++) {
    const isToday = isCurrentMonth && d === today.getDate();
    dates += `<div class="date-cell ${isToday?'today':''}">${d}</div>`;
  }
  document.getElementById('datesRow').innerHTML = dates;
  
  let dotsHTML = '';
  for(let hourIdx = HOUR_LEVELS.length-1; hourIdx >= 0; hourIdx--) {
    dotsHTML += '<div class="dots-row">';
    for(let d=0; d<DAYS; d++) {
      const isToday = isCurrentMonth && d+1 === today.getDate();
      const active = cm.screen[d] === hourIdx;
      dotsHTML += `<div class="dot ${active?'active':''} ${isToday?'today':''}"
        onclick="setScreenHour(${d},${hourIdx})"></div>`;
    }
    dotsHTML += '</div>';
  }
  document.getElementById('dotsContainer').innerHTML = dotsHTML;
  
  drawGraph();
}

function setScreenHour(day, hourLevel) {
  const cm = currentMonth();
  cm.screen[day] = cm.screen[day] === hourLevel ? -1 : hourLevel;
  renderScreenTime();
  updateStats();
  saveState();
}

function drawGraph() {
  const cm = currentMonth();
  const canvas = document.getElementById('screenGraph');
  const ctx = canvas.getContext('2d');
  const rect = canvas.parentElement.getBoundingClientRect();
  canvas.width = rect.width;
  canvas.height = rect.height;
  
  const hours = cm.screen.map(level => {
    if (level === -1) return 0;
    if (level === 5) return 7;
    return level + 2;
  });
  
  const maxH = Math.max(7, ...hours);
  const w = canvas.width - 40, h = canvas.height - 30;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  
  ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--grid');
  ctx.lineWidth = 1;
  for(let i=0; i<=5; i++) {
    const y = 15 + (i/5)*h;
    ctx.beginPath();
    ctx.moveTo(30, y);
    ctx.lineTo(30+w, y);
    ctx.stroke();
    
    ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text2');
    ctx.font = "10px sans-serif";
    ctx.fillText(`${5-i}h`, 15, y+3);
  }
  
  ctx.beginPath();
  const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
  gradient.addColorStop(0, '#8b5cf6');
  gradient.addColorStop(1, '#4f46e5');
  ctx.strokeStyle = gradient;
  ctx.lineWidth = 3;
  ctx.lineJoin = 'round';
  
  for(let d=0; d<DAYS; d++) {
    const x = 30 + (d/(DAYS-1))*w;
    const y = 15 + (1 - hours[d]/maxH)*h;
    if(d===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
  }
  ctx.stroke();
  
  const today = new Date();
  const isCurrentMonth = state.currentMonth === `${today.getFullYear()}-${today.getMonth()+1}`;
  
  for(let d=0; d<DAYS; d++) {
    const x = 30 + (d/(DAYS-1))*w;
    const y = 15 + (1 - hours[d]/maxH)*h;
    
    ctx.beginPath();
    ctx.arc(x,y,6,0,Math.PI*2);
    ctx.fillStyle = '#ffffff';
    ctx.fill();
    ctx.strokeStyle = '#8b5cf6';
    ctx.lineWidth = 2;
    ctx.stroke();
    
    if (isCurrentMonth && d+1 === today.getDate()) {
      ctx.beginPath();
      ctx.arc(x,y,10,0,Math.PI*2);
      ctx.strokeStyle = '#ef4444';
      ctx.lineWidth = 2;
      ctx.stroke();
    }
  }
}

function renderAchievements() {
  const cm = currentMonth();
  document.querySelectorAll('.ach-item').forEach((el,i)=>{
    const dot = el.querySelector('.ach-dot');
    dot.classList.toggle('on', cm.achievements[i]);
    el.onclick = () => {
      cm.achievements[i] = !cm.achievements[i];
      dot.classList.toggle('on', cm.achievements[i]);
      updateStats();
      saveState();
    };
  });
}

function renderHistory() {
  let html = '';
  const keys = Object.keys(state.months).sort().reverse();
  keys.forEach(key => {
    const m = state.months[key];
    const active = key === state.currentMonth;
    const done = Object.values(m.cells).filter(v=>v===1).length;
    const total = ROWS * DAYS;
    const percent = total ? Math.round((done/total)*100) : 0;
    html += `<div class="month-card ${active?'active':''}" onclick="switchMonth('${key}')">
      <div style="font-weight:700;margin-bottom:4px">${m.name}</div>
      <div style="font-size:12px;color:var(--text2)">
        <div>${percent}% complete</div>
        <div>Level ${m.level} • ${m.achievements.filter(a=>a).length}/3 achievements</div>
      </div>
    </div>`;
  });
  
  if (keys.length === 0) {
    html = `<div style="padding:20px;text-align:center;color:var(--text2)">No history yet. Start tracking your first month!</div>`;
  }
  
  document.getElementById('monthHistory').innerHTML = html;
}

function switchMonth(key) {
  state.currentMonth = key;
  renderAll();
}

function updateStats() {
  const cm = currentMonth();
  const today = new Date();
  const isCurrentMonth = state.currentMonth === `${today.getFullYear()}-${today.getMonth()+1}`;
  
  const total = ROWS * DAYS;
  const done = Object.values(cm.cells).filter(v=>v===1).length;
  const progress = total ? Math.round((done/total)*100) : 0;
  document.getElementById('progressStat').textContent = progress + '%';
  
  document.getElementById('levelStat').textContent = cm.level;
  document.getElementById('levelStat').onclick = () => {
    cm.level = cm.level < 10 ? cm.level + 1 : 1;
    updateStats();
    saveState();
  };
  
  let todayHours = 0;
  if (isCurrentMonth) {
    const day = today.getDate()-1;
    const level = cm.screen[day];
    if (level !== -1) {
      todayHours = level === 5 ? 7 : level + 2;
    }
  }
  document.getElementById('screenStat').textContent = todayHours + 'h';
  
  document.getElementById('monthName').textContent = cm.name;
  if (isCurrentMonth) {
    const dayName = DAYS_NAME[today.getDay()];
    document.getElementById('todayDisplay').textContent = `Today: ${dayName}, ${today.getDate()}`;
  } else {
    document.getElementById('todayDisplay').textContent = 'Not current month';
  }
}

document.getElementById('resetBtn').onclick = () => {
  if(confirm('Reset all data for current month?')) {
    const cm = currentMonth();
    cm.cells = {};
    cm.screen = Array(DAYS).fill(-1);
    cm.achievements = [false,false,false];
    renderAll();
    saveState();
  }
};

function renderAll() {
  renderProtocols();
  renderScreenTime();
  renderAchievements();
  renderHistory();
  updateStats();
}

init();
</script>
</body>
</html>
